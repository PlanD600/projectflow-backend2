ProjectFlow Backend API Specification - גרסה סופית
1. מבוא
מסמך זה מספק מפרט טכני מקיף עבור ממשקי ה-API של ProjectFlow Backend. הוא מתאר את כל נקודות הקצה, מודלי הנתונים, ואת פרוטוקולי התקשורת בזמן אמת הנדרשים לתפקוד תקין של האפליקציה.

קהל יעד
מפרט זה מיועד למפתחי צד לקוח (Frontend Developers) ולמפתחי צד שרת (Backend Developers) שיעבדו עם שרת ה-ProjectFlow.

2. עקרונות כלליים
פורמט: כל התקשורת עם ה-API תתבצע דרך ממשק RESTful באמצעות JSON.

אימות (Authentication):

כל הבקשות, למעט POST /api/auth/register ו-POST /api/auth/otp/**, חייבות להיות מאומתות.

האימות מתבצע באמצעות Bearer Token (JWT) הנשלח בכותרת Authorization.

דוגמה לכותרת אימות: Authorization: Bearer <your_jwt_token>

הקשר ארגוני (Organization Context):

כל הבקשות הפועלות בהקשר של ארגון (לדוגמה: אחזור פרויקטים, משתמשים וכו') חייבות לכלול את כותרת X-Organization-Id.

הלקוח אחראי לאחסן ולשלוח כותרת זו לאחר שהמשתמש בוחר ארגון פעיל.

דוגמה לכותרת ארגון: X-Organization-Id: <your_organization_id>

חותמות זמן (Timestamps): כל מודלי הנתונים העיקריים (User, Organization, Project, Task, Message, Notification, Comment, Team, FinanceEntry) כוללים שדות createdAt ו-updatedAt (בפורמט ISO string), המנוהלים אוטומטית על ידי השרת.

פג'ינציה (Pagination):

כל נקודות הקצה מסוג GET המחזירות מערך (לדוגמה: GET /api/projects, GET /api/users) תומכות בפג'ינציה דרך Query Parameters.

פרמטרים:

?page=<number> (ברירת מחדל: 1)

?limit=<number> (ברירת מחדל: 25 או 50 עבור הודעות)

מבנה תגובה: התגובה עבור משאב עם פג'ינציה תהיה אובייקט המכיל את הנתונים ומטא-דאטה של הפג'ינציה:

JSON

{
  "data": [ /* ...items... */ ],
  "totalItems": 150,
  "totalPages": 6,
  "currentPage": 1
}
מיון (Sorting):

כל נקודות הקצה מסוג GET המחזירות מערך תומכות במיון.

פרמטרים:

?sortBy=<field_name> (לדוגמה: createdAt, title, date).

?sortOrder=<asc|desc> (ברירת מחדל: desc).

3. טיפול בשגיאות (Error Handling)
השרת מחזיר תגובות שגיאה סטנדרטיות בפורמט JSON:

JSON

{
  "message": "A descriptive error message for the user or developer.",
  "errors": {
    "details": "Optional additional technical details or validation errors."
  }
}
קוד סטטוס (HTTP Status Code)	משמעות	תיאור	דוגמה לגוף תגובה (JSON)
400	Bad Request	שגיאה כללית בצד הלקוח, כמו פורמט JSON שגוי, פרמטרים חסרים/לא תקינים.	{ "message": "Malformed request body." }
401	Unauthorized	אסימון ה-JWT חסר, לא חוקי או פג תוקף. הלקוח צריך להפנות לדף ההתחברות.	{ "message": "Authentication token is required." }
403	Forbidden	המשתמש מאומת אך אין לו את ההרשאות הנדרשות לביצוע הפעולה.	{ "message": "You do not have permission to perform this action." }
404	Not Found	המשאב המבוקש (לדוגמה, פרויקט או משתמש ספציפי) לא נמצא.	{ "message": "Project with ID '123' not found." }
409	Conflict	בקשה תקינה מבחינת פורמט, אך יוצרת קונפליקט עם מצב קיים (לדוגמה, ניסיון ליצור משאב קיים).	{ "message": "User with this phone number already exists." }
422	Unprocessable Entity	הבקשה הייתה בפורמט תקין אך הכילה שגיאות סמנטיות (לדוגמה, ולידציה נכשלה).	{ "message": "Validation failed.", "errors": [{ "field": "phone", "message": "Phone number is invalid." }] }
500	Internal Server Error	שגיאה כללית בצד השרת.	{ "message": "An unexpected server error occurred." }

ייצוא אל Sheets
4. מפרט נקודות קצה של ה-API
4.1 אימות (Authentication) - /api/auth
פעולה	שיטה ונתיב	הרשאות	גוף בקשה (Request Body)	תגובת הצלחה (200 OK)
הרשמה (Register)	POST /auth/register	ציבורי	{ fullName: string, phone: string, organizationName: string }	{ message: "Registration successful. Please verify OTP to log in." }
שליחת OTP לכניסה	POST /auth/otp/send	ציבורי	{ phone: string }	{ message: "OTP sent successfully." }
אימות OTP וכניסה	POST /auth/otp/verify	ציבורי	{ phone: string, otpCode: string }	{ token: string, user: User, memberships: Membership[] }
קבלת חברויות שלי	GET /auth/me/memberships	מאומת	(אין)	Membership[]
קבלת הפרופיל שלי	GET /auth/me	מאומת	(אין)	User
עדכון הפרופיל שלי	PUT /auth/me	מאומת	{ fullName?: string, jobTitle?: string, email?: string, profilePictureUrl?: string }	User (אובייקט המשתמש המעודכן)

ייצוא אל Sheets
4.2 פרויקטים (Projects) - /api/projects
דורש: אימות וכותרת X-Organization-Id.

| פעולה                     | שיטה ונתיב              | הרשאות                                         | גוף בקשה (Request Body)                                                                                             | תגובת הצלחה (200 OK)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Project (הפרויקט החדש שנוצר) (201 Created) |
| קבלת כל הפרויקטים | GET /projects         | EMPLOYEE ומעלה                                | (תומך בפג'ינציה ומיון - ?page, ?limit, ?sortBy, ?sortOrder)                                    | PaginatedResponse<Project[]> (עובדים יראו פרויקטים המשויכים אליהם)           |
| יצירת פרויקט | POST /projects        | ADMIN, SUPER_ADMIN                             | { title: string, description?: string, teamLeads: string[], startDate?: string, endDate?: string, budget?: number } | Project (הפרויקט החדש שנוצר)                                                  |
| עדכון פרויקט | PUT /projects/:projectId| ADMIN, SUPER_ADMIN, TEAM_LEADER* (של הפרויקט) | { title?: string, description?: string, teamLeads?: string[], startDate?: string, endDate?: string, budget?: number } | Project (הפרויקט המעודכן)                                                     |
| אריכיון/ביטול אריכיון | PATCH /projects/:projectId| ADMIN, SUPER_ADMIN, TEAM_LEADER* (של הפרויקט) | { isArchived: boolean }                                                                           | Project (הפרויקט המעודכן)                                                     |
| מחיקת פרויקט | DELETE /projects/:projectId| ADMIN, SUPER_ADMIN                             | (אין)                                                                                 | (204 No Content)                                                                |

4.3 משימות (Tasks) - /api/projects/:projectId/tasks
דורש: אימות וכותרת X-Organization-Id.

פעולה	שיטה ונתיב	הרשאות	גוף בקשה (Request Body)	תגובת הצלחה (200 OK)
קבלת משימות לפרויקט	GET /projects/:projectId/tasks	EMPLOYEE ומעלה	(תומך בפג'ינציה ומיון)	PaginatedResponse<Task[]>
יצירת משימה	POST /projects/:projectId/tasks	ADMIN, SUPER_ADMIN, TEAM_LEADER* (של הפרויקט)	{ title: string, description?: string, assigneesIds?: string[], startDate?: string, endDate?: string, expense?: number, color: string }	Task (המשימה החדשה שנוצרה) (201 Created)
עדכון משימה	PUT /projects/:projectId/tasks/:taskId	Assignees: יכולים לעדכן status. <br> TEAM_LEADER*: יכולים לעדכן את כל השדות.
ADMIN+: יכולים לעדכן את כל השדות.	{ title?: string, description?: string, assigneesIds?: string[], status?: TaskStatus, startDate?: string, endDate?: string, expense?: number, color?: string }	Task (המשימה המעודכנת)
מחיקת משימה	DELETE /projects/:projectId/tasks/:taskId	ADMIN, SUPER_ADMIN, TEAM_LEADER* (של הפרויקט)	(אין)	(204 No Content)
הוספת תגובה למשימה	POST /projects/:projectId/tasks/:taskId/comments	EMPLOYEE ומעלה (כל חבר בפרויקט)	{ content: string }	Comment (התגובה החדשה) (201 Created)

ייצוא אל Sheets
4.4 משתמשים וצוותים (Users & Teams) - /api/
דורש: אימות וכותרת X-Organization-Id. רוב הפעולות מוגבלות לתפקידי ADMIN.

פעולה	שיטה ונתיב	הרשאות	גוף בקשה (Request Body)	תגובת הצלחה (200 OK)
קבלת כל המשתמשים בארגון	GET /users	ADMIN, SUPER_ADMIN	(תומך בפג'ינציה ומיון)	PaginatedResponse<Membership[]>
הזמנת משתמש	POST /users/invite	ADMIN, SUPER_ADMIN	{ fullName: string, phone: string, jobTitle: string, role: Membership['role'] }	Membership (החברות החדשה שנוצרה) (201 Created)
עדכון תפקיד משתמש	PUT /users/:userId/membership	ADMIN, SUPER_ADMIN (לא ניתן לערוך תפקיד גבוה/שווה)	{ role: Membership['role'] }	Membership (החברות המעודכנת)
הסרת משתמש מהארגון	DELETE /users/:userId/membership	ADMIN, SUPER_ADMIN (לא ניתן להסיר את עצמך או תפקיד גבוה/שווה)	(אין)	(204 No Content)
קבלת כל הצוותים	GET /teams	ADMIN, SUPER_ADMIN	(תומך בפג'ינציה ומיון)	PaginatedResponse<Team[]>
יצירת צוות	POST /teams	ADMIN, SUPER_ADMIN	{ name: string, leadIds: string[], memberIds: string[] }	Team (הצוות החדש שנוצר) (201 Created)
עדכון צוות	PUT /teams/:teamId	ADMIN, SUPER_ADMIN	{ name?: string, leadIds?: string[], memberIds?: string[] }	Team (הצוות המעודכן)
מחיקת צוות	DELETE /teams/:teamId	ADMIN, SUPER_ADMIN	(אין)	(204 No Content)

ייצוא אל Sheets
4.5 כספים (Finance) - /api/finance
דורש: ADMIN או SUPER_ADMIN role, אימות וכותרת X-Organization-Id.

פעולה	שיטה ונתיב	הרשאות	גוף בקשה (Request Body)	תגובת הצלחה (200 OK)
קבלת סיכום פיננסי	GET /finance/summary	ADMIN, SUPER_ADMIN	(Query Params: ?projectId=all או ?projectId=<id>)	FinanceSummary
קבלת רשומות פיננסיות	GET /finance/entries	ADMIN, SUPER_ADMIN	(Query Params: ?projectId=all או ?projectId=<id>, ותומך בפג'ינציה ומיון)	PaginatedResponse<FinanceEntry[]>
יצירת רשומה פיננסית	POST /finance/entries	ADMIN, SUPER_ADMIN	`{ type: 'INCOME'	'EXPENSE', amount: number, description: string, date: string (YYYY-MM-DD), projectId?: string, taskId?: string }`

ייצוא אל Sheets
4.6 צ'אט (Chat) - /api/conversations
דורש: אימות וכותרת X-Organization-Id.

פעולה	שיטה ונתיב	הרשאות	גוף בקשה (Request Body)	תגובת הצלחה (200 OK)
קבלת כל השיחות	GET /conversations	מאומת	(אין)	Conversation[]
יצירת שיחה	POST /conversations	מאומת	`{ type: 'private'	'group', participantIds: string[], name?: string, avatarUrl?: string }`
קבלת הודעות לשיחה	GET /conversations/:conversationId/messages	מאומת	(תומך בפג'ינציה: ?page=1&limit=50)	{ messages: Message[], totalPages: number, currentPage: number }

ייצוא אל Sheets
5. תקשורת בזמן אמת (WebSockets)
הלקוח יקים חיבור WebSocket לאחר ההתחברות לצורך צ'אט והתראות בזמן אמת.
כתובת חיבור WebSocket: ws://localhost:3000 (בפיתוח). בייצור, השתמשו בכתובת השרת האמיתית.

אירועים שהלקוח שולח (Emits to Server)
register_for_notifications

תיאור: נשלח על ידי הלקוח מיד לאחר החיבור ל-WebSocket כדי להירשם לקבלת התראות עבור משתמש ספציפי. השרת יצרף את ה-socket ל"חדר" ששמו הוא ה-userId.

Payload: string (userId)

join_conversation

תיאור: נשלח על ידי הלקוח כדי להצטרף ל"חדר" של שיחה ספציפית, על מנת לקבל הודעות המיועדות לשיחה זו.

Payload: string (conversationId)

send_message

תיאור: נשלח כאשר משתמש שולח הודעת צ'אט חדשה.

Payload:

TypeScript

{
  conversationId: string;
  text: string;
  senderId: string; // אזהרה: בייצור, זה צריך לבוא מאימות ה-socket
}
אירועים שהלקוח מאזין להם (Listens from Server)
new_message

תיאור: מתקבל כאשר הודעה חדשה נשלחת באחת מהשיחות שהמשתמש חבר בהן.

Payload: אובייקט Message, מורחב עם conversationId.

TypeScript

{
  id: string;
  sender: User; // אובייקט User מלא (או לפחות id, fullName, profilePictureUrl)
  text: string;
  timestamp: string; // ISO String
  conversationId: string;
}
new_notification

תיאור: מתקבל כאשר נוצרת התראה חדשה עבור המשתמש.

Payload: אובייקט Notification.

TypeScript

{
  id: string;
  type: 'comment' | 'assignment' | 'status_change' | 'deadline';
  text: string;
  timestamp: string; // ISO String
  read: boolean;
  link?: string; // נתיב יחסי לניווט בקצה הלקוח (לדוגמה: "/projects/1/tasks/2")
}
error_message

תיאור: מתקבל אם אירעה שגיאה בטיפול באירוע WebSocket בצד השרת (לדוגמה, שליחת הודעה עם נתונים חסרים).

Payload: { message: string }

6. מודלי נתונים (Data Models)
מודלי הנתונים הבאים מוגדרים בצד השרת וצד הלקוח (כ-TypeScript Interfaces) ומבטיחים עקביות בנתונים. כל המודלים כוללים id (string), createdAt (ISO string) ו-updatedAt (ISO string).

TypeScript

// Base interface for all major models
interface BaseModel {
  id: string;
  createdAt: string; // ISO String
  updatedAt: string; // ISO String
}

export interface User extends BaseModel {
  fullName: string;
  phone: string;
  email?: string;
  profilePictureUrl?: string;
  jobTitle?: string;
}

export interface Organization extends BaseModel {
  name: string;
}

// Defines a user's role within a specific organization
export interface Membership extends BaseModel {
  userId: string;
  organizationId: string;
  role: 'SUPER_ADMIN' | 'ADMIN' | 'TEAM_LEADER' | 'EMPLOYEE';
  organization: Organization; // Populated by server
  user: User; // Populated by server
}

export interface Comment extends BaseModel {
  author: User; // Populated User object (id, fullName, avatar)
  content: string;
}

export type TaskStatus = 'מתוכנן' | 'בתהליך' | 'תקוע' | 'הושלם';

export interface Task extends BaseModel {
  title: string;
  description?: string;
  assignees: User[]; // Populated array of User objects
  startDate?: string; // YYYY-MM-DD
  endDate?: string; // YYYY-MM-DD
  expense?: number;
  status: TaskStatus;
  color: string;
  comments: Comment[]; // Populated array of Comment objects
  subtasks: Task[]; // (לא מיושם באיטרציה זו)
}

export type ProjectStatus = 'מתוכנן' | 'בתהליך' | 'לקראת סיום' | 'בסיכון' | 'מוקפא' | 'הושלם';

export interface Project extends BaseModel {
  title: string;
  description?: string;
  startDate?: string; // YYYY-MM-DD
  endDate?: string; // YYYY-MM-DD
  budget?: number;
  status: ProjectStatus;
  isArchived: boolean;
  team: Team[]; // Populated array of Team objects
  teamLeads: User[]; // Populated array of User objects
  tasks: Task[]; // Populated array of Task objects
}

export type FinanceEntryType = 'INCOME' | 'EXPENSE';

export interface FinanceEntry extends BaseModel {
  type: FinanceEntryType;
  amount: number;
  description: string;
  date: string; // ISO String
  projectId?: string;
  taskId?: string;
  projectTitle?: string; // Populated by server if projectId is present
}

export interface FinanceSummary {
    totalIncome: number;
    totalExpenses: number;
    balance: number;
}

export interface Team extends BaseModel {
  name: string;
  leadIds: string[]; // Stored as IDs
  memberIds: string[]; // Stored as IDs
  leads?: User[]; // Populated by server
  members?: User[]; // Populated by server
}

export interface Message extends BaseModel {
  sender: User; // Populated User object
  text: string;
}

export interface Conversation extends BaseModel {
  type: 'private' | 'group';
  participants: User[]; // Populated array of User objects
  name?: string; // For group chats only
  avatarUrl?: string; // For group chats only
  messages: Message[];
  unreadCount?: number; // Calculated per-user by the server (לא מיושם באיטרציה זו)
}

export interface Notification extends BaseModel {
  type: 'comment' | 'assignment' | 'status_change' | 'deadline';
  text: string;
  read: boolean;
  link: string; // A relative path for the client, e.g., "/projects/1/tasks/2"
}

// מבנה תגובה עבור נקודות קצה עם פג'ינציה
export interface PaginatedResponse<T> {
  data: T;
  totalItems: number;
  totalPages: number;
  currentPage: number;
}
מסמך זה מסכם את כל מה שבנינו. הוא אמור לשמש כנקודת התייחסות מרכזית לכל פונקציונליות השרת.